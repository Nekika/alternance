(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{366:function(e,t,s){e.exports=s.p+"assets/img/preview.70f7ddba.gif"},391:function(e,t,s){"use strict";s.r(t);var r=s(43),n=Object(r.a)({},(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h1",{attrs:{id:"smc-selection-multi-couches"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#smc-selection-multi-couches"}},[e._v("#")]),e._v(" SMC (Sélection Multi Couches)")]),e._v(" "),r("h2",{attrs:{id:"introduction"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#introduction"}},[e._v("#")]),e._v(" Introduction")]),e._v(" "),r("p",[e._v("J'ai été chargé de créer un plugin pour "),r("strong",[e._v("QGIS")]),e._v(" permettant de sélectionner instantanément toutes les entités visibles dans l'interface.")]),e._v(" "),r("div",{staticClass:"custom-block tip"},[r("p",{staticClass:"custom-block-title"},[e._v("Informations")]),e._v(" "),r("p",[r("strong",[e._v("Contexte")]),e._v(" : Le logiciel QGIS est utilisé par les géomaticiens et les agents de terrain chargés de collecter des données à travers le département de Meurthe-et-Moselle.")]),e._v(" "),r("p",[r("strong",[e._v("Problème")]),e._v(" : N'ayant pas de connexion internet sur le terrain, les agents n'ont donc pas accès aux bases de données. Il sont alors contraints de sauvegader les données sur leur ordinateur portable avant de partir. Cette tâche est fastidieuse puisqu'ils doivent sélectionner manuellement chaque entité qu'ils souhaient sauvegarder en cliquant dessus. Cela devient très pénible pour des projets de grande envergure.")]),e._v(" "),r("p",[r("strong",[e._v("Objectif")]),e._v(" : Développer un plugin QGIS permettant la sélection de toutes les entités présentes dans l'emprise définie par l'utilisateur.")]),e._v(" "),r("p",[r("strong",[e._v("Technologie utilisée")]),e._v(" : Python")])]),e._v(" "),r("h2",{attrs:{id:"analyse"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#analyse"}},[e._v("#")]),e._v(" Analyse")]),e._v(" "),r("p",[e._v("Ma mission consistant à "),r("strong",[e._v("développer un plugin")]),e._v(", j'ai donc commencé par prendre le temps de "),r("strong",[e._v("chercher des informations")]),e._v(" et de lire la "),r("a",{attrs:{href:"https://docs.qgis.org/3.10/fr/docs/index.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("documentation"),r("OutboundLink")],1),e._v(" avant "),r("strong",[e._v("d'analyser le besoin")]),e._v(".")]),e._v(" "),r("h3",{attrs:{id:"integration-d-un-plugin"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#integration-d-un-plugin"}},[e._v("#")]),e._v(" Intégration d'un plugin")]),e._v(" "),r("p",[e._v("Afin d'intégrer un plugin local, QGIS nous propose de placer notre code dans un répertoire qu'il viendra scanner au démarrage :")]),e._v(" "),r("div",{staticClass:"language-shell extra-class"},[r("pre",{pre:!0,attrs:{class:"language-shell"}},[r("code",[r("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Exemple de structure de fichiers")]),e._v("\n\n-- "),r("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$REPERTOIRE_QGIS")]),e._v("\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- profiles\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- default\n      "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- python\n        "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- plugins\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- mon_profil\n      "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- python\n        "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- plugins\n")])])]),r("ul",[r("li",[r("p",[r("code",[e._v("profiles")]),e._v(" : le répertoire qui stocke les différents profils utilisateurs.")])]),e._v(" "),r("li",[r("p",[r("code",[e._v("profiles/*/python/plugins")]),e._v(" : le sous-répertoire scanné par QGIS, dans lequel on peut retrouver le code source des extensions.")])])]),e._v(" "),r("div",{staticClass:"custom-block warning"},[r("p",{staticClass:"custom-block-title"},[e._v("Note")]),e._v(" "),r("p",[e._v("Le répertoire "),r("code",[e._v("profiles/default")]),e._v(" permet de définir des configurations qui seront appliqués à l'utilisateur par défaut "),r("strong",[e._v("ET")]),e._v(" à tous les utilisateurs.")]),e._v(" "),r("p",[e._v("Ainsi, dans le répertoire "),r("code",[e._v("profiles/default/python/plugins")]),e._v(" on pourra retrouver des extensions disponibles pour tous les utilisateurs tandis que le répertoire "),r("code",[e._v("profiles/mon_profil/python/plugins")]),e._v(" contiendra des extentions destinées à l'utilisateur "),r("em",[e._v("mon_profil")]),e._v(" "),r("strong",[e._v("uniquement")]),e._v(".")])]),e._v(" "),r("h3",{attrs:{id:"developpement-d-un-plugin"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#developpement-d-un-plugin"}},[e._v("#")]),e._v(" Développement d'un plugin")]),e._v(" "),r("p",[e._v("Pour le développement de plugins, QGIS encourage l'utilisation de "),r("strong",[e._v("Python")]),e._v(" plutôt que C++.")]),e._v(" "),r("p",[e._v("Ainsi, sur la documentation officielle de QGIS, on peut retrouver le "),r("a",{attrs:{href:"https://docs.qgis.org/3.10/en/docs/pyqgis_developer_cookbook/index.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("PyQGIS Developer Cookbook"),r("OutboundLink")],1),e._v(" qui explique de manière détaillée la marche à suivre pour créer un plugin en utilisant "),r("a",{attrs:{href:"https://qgis.org/pyqgis/3.0/",target:"_blank",rel:"noopener noreferrer"}},[e._v("l'API Python"),r("OutboundLink")],1),e._v(".")]),e._v(" "),r("h4",{attrs:{id:"structure-d-un-plugin"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#structure-d-un-plugin"}},[e._v("#")]),e._v(" Structure d'un plugin")]),e._v(" "),r("div",{staticClass:"language-shell extra-class"},[r("pre",{pre:!0,attrs:{class:"language-shell"}},[r("code",[r("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Structure minimale")]),e._v("\n\n-- "),r("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$REPERTOIRE_QGIS_PLUGINS")]),e._v("\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- mon_super_plugin\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- __init__.py\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- form.ui\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- form.py\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- metadata.txt\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- mon_super_plugin.py\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- resources.py\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- resources.qrc\n")])])]),r("ul",[r("li",[r("p",[r("code",[e._v("__init__.py")]),e._v(" : le point d'entrée du plugin.")])]),e._v(" "),r("li",[r("p",[r("code",[e._v("form.ui")]),e._v(" : l'interface utilisateur que l'on peut éditer avec "),r("a",{attrs:{href:"https://doc.qt.io/qt-5/qtdesigner-manual.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Qt Designer"),r("OutboundLink")],1),e._v(".")])]),e._v(" "),r("li",[r("p",[r("code",[e._v("form.py")]),e._v(" : la version compilée en Python de "),r("code",[e._v("form.ui")]),e._v(".")])]),e._v(" "),r("li",[r("p",[r("code",[e._v("metadata.txt")]),e._v(" : les métadonnées relatives au plugin.")])]),e._v(" "),r("li",[r("p",[r("code",[e._v("mon_super_plugin.py")]),e._v(" : le code source du plugin.")])]),e._v(" "),r("li",[r("p",[r("code",[e._v("resources.py")]),e._v(" : la version compilée en Python de "),r("code",[e._v("resources.qrc")])])]),e._v(" "),r("li",[r("p",[r("code",[e._v("resources.qrc")]),e._v(" : un fichier au format XML créé par "),r("a",{attrs:{href:"https://doc.qt.io/qt-5/qtdesigner-manual.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Qt Designer"),r("OutboundLink")],1),e._v(" et contenant des informations relatives à l'interface utilisateur.")])])]),e._v(" "),r("p",[e._v("Ces fichiers composent le "),r("strong",[e._v("squelette de base")]),e._v(" d'un plugin QGIS.")]),e._v(" "),r("p",[e._v("Pour un plugin d'une "),r("strong",[e._v("plus grande ampleur")]),e._v(" il est possible de se retrouver avec des architectures telles que celle-ci :")]),e._v(" "),r("div",{staticClass:"language-shell extra-class"},[r("pre",{pre:!0,attrs:{class:"language-shell"}},[r("code",[r("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Structure complexe")]),e._v("\n\n-- "),r("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$REPERTOIRE_QGIS_PLUGINS")]),e._v("\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- mon_super_plugin\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- "),r("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("help")]),e._v("\n      "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- build\n        "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- html\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- make.bat\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- Makefile\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- "),r("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("source")]),e._v("\n      "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- conf.py\n      "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- index.rst\n      "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- _static\n      "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- _templates\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- i18n\n      "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- af.ts\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- icon.png\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- __init__.py\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- Makefile\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- metadata.txt\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- mon_super_plugin_dialog_base.ui\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- mon_super_plugin_dialog.py\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- mon_super_plugin.py\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- pb_tool.cfg\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- plugin_upload.py\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- pylintrc\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- README.html\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- README.txt\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- resources.py\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- resources.qrc\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- scripts\n      "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- compile-strings.sh\n      "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- run-env-linux.sh\n      "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- update-strings.sh\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- "),r("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("test")]),e._v("\n      "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- __init__.py\n      "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- qgis_interface.py\n      "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- tenbytenraster.asc\n      "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- tenbytenraster.asc.aux.xml\n      "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- tenbytenraster.keywords\n      "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- tenbytenraster.lic\n      "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- tenbytenraster.prj\n      "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- tenbytenraster.qml\n      "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- test_init.py\n      "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- test_mon_super_plugin_dialog.py\n      "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- test_qgis_environment.py\n      "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- test_resources.py\n      "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- test_translations.py\n      "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- utilities.py\n")])])]),r("p",[e._v("Dans notre cas, une "),r("strong",[e._v("structure simple")]),e._v(" suffira puisque le plugin ne contiendra que "),r("strong",[e._v("quelques instructions")]),e._v(".")]),e._v(" "),r("h3",{attrs:{id:"besoin"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#besoin"}},[e._v("#")]),e._v(" Besoin")]),e._v(" "),r("p",[e._v("Il faut permettre à l'utilisateur de "),r("strong",[e._v("gagner du temps")]),e._v(" en obtenant "),r("strong",[e._v("immédiatement")]),e._v(" une sélection de "),r("strong",[e._v("toutes les entités")]),e._v(" présentes dans l'emprise, tout en effectuant "),r("strong",[e._v("le moins d'action possible")]),e._v(".")]),e._v(" "),r("div",{staticClass:"custom-block warning"},[r("p",{staticClass:"custom-block-title"},[e._v("Note")]),e._v(" "),r("p",[e._v("Les utilisateurs finaux sélectionnent les entités de toutes les couches du projet, sauf une (la couche "),r("em",[e._v("Communes")]),e._v(").")]),e._v(" "),r("p",[e._v("Il n'était alors pas nécessaire de fournir une interface utilisateur permettant de sélectionner les couches sur lesquelles effectuer la sélection.")])]),e._v(" "),r("h2",{attrs:{id:"solution-proposee"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#solution-proposee"}},[e._v("#")]),e._v(" Solution proposée")]),e._v(" "),r("p",[e._v("L'idée est de fournir un outil capable d'effectuer la sélection "),r("strong",[e._v("en un seul clic")]),e._v(" :")]),e._v(" "),r("img",{attrs:{title:"",src:s(366),alt:"smc_preview","data-align":"center"}}),e._v(" "),r("h3",{attrs:{id:"structure"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#structure"}},[e._v("#")]),e._v(" Structure")]),e._v(" "),r("p",[e._v("L'architecture est très "),r("strong",[e._v("simplifiée")]),e._v(" puisque d'une part il n'y a que quelques instructions à fournir, et d'autre part il n'y a pas besoin d'interface utilisateur :")]),e._v(" "),r("div",{staticClass:"language-shell extra-class"},[r("pre",{pre:!0,attrs:{class:"language-shell"}},[r("code",[e._v("-- "),r("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$REPERTOIRE_QGIS_PLUGINS")]),e._v("\n  "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- SMC\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- __init.py__\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- icon.png\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- metadata.txt\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- pb_tool.cfg\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- smc.py\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- README.md\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- resources.py\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- resources.qrc\n    "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v("-- tools.py\n")])])]),r("p",[e._v("On remarque tout de même la présence de nouveaux fichiers :")]),e._v(" "),r("ul",[r("li",[r("p",[r("code",[e._v("icon.png")]),e._v(" : l'icone qui représente le plugin dans l'interface de QGIS.")])]),e._v(" "),r("li",[r("p",[r("code",[e._v("pb_tool.cfg")]),e._v(" : un outil permettant de compiler le plugin, voir "),r("a",{attrs:{href:"http://g-sherman.github.io/plugin_build_tool/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Plugin Builder Tool"),r("OutboundLink")],1),e._v(".")])]),e._v(" "),r("li",[r("p",[r("code",[e._v("tools.py")]),e._v(" : des fonctions dont la présence au sein du coeur du plugin n'était pas pertinente.")])])]),e._v(" "),r("h3",{attrs:{id:"code"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#code"}},[e._v("#")]),e._v(" Code")]),e._v(" "),r("p",[e._v("L'utilisation de "),r("a",{attrs:{href:"https://qgis.org/pyqgis/3.0/",target:"_blank",rel:"noopener noreferrer"}},[e._v("l'API Python"),r("OutboundLink")],1),e._v(" de QGIS rend le code "),r("strong",[e._v("simple à lire et à comprendre")]),e._v(" même pour quelqu'un n'ayant jamais manipuler Python. Je vais donc me permettre de détailler le fonctionnement du plugin.")]),e._v(" "),r("p",[e._v("Le "),r("strong",[e._v("fichier principal")]),e._v(" ( "),r("code",[e._v("smc.py")]),e._v(" ) est une classe qui doit implémenter des "),r("strong",[e._v("méthodes définies par l'API")]),e._v(".")]),e._v(" "),r("p",[e._v("Ces méthodes servent à "),r("strong",[e._v("configurer")]),e._v(" le plugin lors du démarrage de QGIS. Elles sont donc "),r("strong",[e._v("indispensables")]),e._v(".")]),e._v(" "),r("div",{staticClass:"custom-block warning"},[r("p",{staticClass:"custom-block-title"},[e._v("Note")]),e._v(" "),r("p",[e._v("L'idée n'étant pas d'expliquer les mécanismes derrière le fonctionnement global d'un plugin, je me contenterai d'expliquer ce que j'ai développé.")]),e._v(" "),r("p",[e._v("Pour plus de détail sur ces méthodes ou sur le fonctionnement des plugins, se référer au "),r("a",{attrs:{href:"https://docs.qgis.org/3.10/en/docs/pyqgis_developer_cookbook/plugins/plugins.html#writing-a-plugin",target:"_blank",rel:"noopener noreferrer"}},[e._v("PyQGIS Developer Cookbook"),r("OutboundLink")],1),e._v(".")])]),e._v(" "),r("p",[e._v("Parmi les méthodes "),r("strong",[e._v("indispensables")]),e._v(", on peut retrouver "),r("code",[e._v("run()")]),e._v(".")]),e._v(" "),r("p",[e._v("C'est elle qui sera appelée lorsque l'utilisateur souhaite se servir du plugin, c'est donc à l'intérieur que l'on va indiquer les "),r("strong",[e._v("actions à effectuer")]),e._v(" :")]),e._v(" "),r("div",{staticClass:"language-python extra-class"},[r("pre",{pre:!0,attrs:{class:"language-python"}},[r("code",[r("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("def")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token function"}},[e._v("run")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("self"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  layers "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" get_all_vectorLayers"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n  extent "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" self"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("get_extent"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n  select_features_in_area"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("layers"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" extent"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),r("p",[e._v("On remarque que cette méthode fait appel à "),r("strong",[e._v("2 fonctions")]),e._v(" et "),r("strong",[e._v("une autre méthode")]),e._v(" :")]),e._v(" "),r("ul",[r("li",[r("strong",[r("code",[e._v("get_all_vectorLayers()")])])])]),e._v(" "),r("p",[e._v("Cette fonction permet de "),r("strong",[e._v("récupérer la liste des couches vectorielles")]),e._v(" du projet puisque c'est sur celles-ci que sont représentées les entités à sélectionner :")]),e._v(" "),r("div",{staticClass:"language-python extra-class"},[r("pre",{pre:!0,attrs:{class:"language-python"}},[r("code",[r("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("def")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token function"}},[e._v("get_all_vectorLayers")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    res "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n    layers "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" QgsProject"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("instance"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("mapLayers"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("values"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n    "),r("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("for")]),e._v(" layer "),r("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("in")]),e._v(" layers"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n        "),r("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" layer"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),r("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("type")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("==")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("and")]),e._v(" layer"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("name"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!=")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Communes"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n            res"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("append"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("layer"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n    "),r("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" res\n")])])]),r("p",[e._v("En se référant à la classe "),r("a",{attrs:{href:"https://qgis.org/pyqgis/master/core/QgsMapLayer.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("QgsMapLayer"),r("OutboundLink")],1),e._v(", on découvre que la méthode "),r("code",[e._v("type()")]),e._v(" nous offre le moyen de "),r("strong",[e._v("connaître le type de la couche")]),e._v(" :")]),e._v(" "),r("ul",[r("li",[r("p",[r("strong",[e._v("VectorLayer")]),e._v(" : 0")])]),e._v(" "),r("li",[r("p",[r("strong",[e._v("RasterLayer")]),e._v(" : 1")])]),e._v(" "),r("li",[r("p",[r("strong",[e._v("PluginLayer")]),e._v(" : 2")])]),e._v(" "),r("li",[r("p",[r("strong",[e._v("MeshLayer")]),e._v(" : 3")])]),e._v(" "),r("li",[r("p",[r("strong",[e._v("VectorTileLayer")]),e._v(" : 4")])])]),e._v(" "),r("p",[e._v("La condition "),r("code",[e._v('if layer.type() == 0 and layer.name() != "Communes":')]),e._v(" permet donc de s'assurer d'une part que la couche traitée est bel et bien de "),r("strong",[e._v("type vectoriel")]),e._v(", et d'autre par que la couche traitée n'est pas la couche "),r("em",[e._v("Communes")]),e._v(".")]),e._v(" "),r("ul",[r("li",[r("strong",[r("code",[e._v("get_extent()")])])])]),e._v(" "),r("p",[e._v("C'est la méthode qui va permettre de "),r("strong",[e._v("récupérer les coordonnées de l'emprise")]),e._v(" réglée par l'utilisateur :")]),e._v(" "),r("div",{staticClass:"language-python extra-class"},[r("pre",{pre:!0,attrs:{class:"language-python"}},[r("code",[r("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("def")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token function"}},[e._v("get_extent")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("self"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  mapcanvas "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" self"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("iface"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("mapCanvas"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n  extent "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" mapcanvas"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("extent"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n  "),r("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" extent\n")])])]),r("p",[e._v("La méthode se contente de "),r("strong",[e._v("récupérer l'instance de "),r("a",{attrs:{href:"https://qgis.org/pyqgis/master/gui/QgsMapCanvas.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("MapCanvas"),r("OutboundLink")],1)]),e._v(" et d'utiliser la méthode "),r("code",[e._v("extent()")]),e._v(" pour pouvoir "),r("strong",[e._v("récupérer les coordonées")]),e._v(" de l'emprise.")]),e._v(" "),r("ul",[r("li",[r("strong",[r("code",[e._v("select_features_in_area()")])])])]),e._v(" "),r("p",[e._v("Les tâches effectuées en amont ayant permis de récupérer des données qui sont nécessaires pour pouvoir répondre au besoin, cette dernière fonction va se charger "),r("strong",[e._v("d'effectuer la sélection")]),e._v(" de toutes les entités présentes dans l'emprise :")]),e._v(" "),r("div",{staticClass:"language-python extra-class"},[r("pre",{pre:!0,attrs:{class:"language-python"}},[r("code",[r("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("def")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token function"}},[e._v("select_features_in_area")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("layers"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" area"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n  "),r("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("for")]),e._v(" layer "),r("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("in")]),e._v(" layers"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n    layer"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("selectByRect"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("area"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),r("p",[e._v("Cette fonction très simple fait appel à la méthode "),r("code",[e._v("selectByRect")]),e._v(" de la classe "),r("a",{attrs:{href:"https://qgis.org/pyqgis/master/core/QgsVectorLayer.html#qgis.core.QgsVectorLayer.selectByRect",target:"_blank",rel:"noopener noreferrer"}},[e._v("QgsVectorLayer"),r("OutboundLink")],1),e._v(" et elle permet, à partir d'une couche vectorielle, de "),r("strong",[e._v("sélectionner toutes les entités contenues au sein d'un rectangle")]),e._v(".")]),e._v(" "),r("p",[e._v("Dans notre cas, le rectangle n'est autre que "),r("strong",[e._v("l'emprise")]),e._v(" réglée par l'utilisateur.")]),e._v(" "),r("h2",{attrs:{id:"conclusion"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#conclusion"}},[e._v("#")]),e._v(" Conclusion")]),e._v(" "),r("p",[e._v("Grâce à "),r("a",{attrs:{href:"https://qgis.org/pyqgis/3.0/",target:"_blank",rel:"noopener noreferrer"}},[e._v("l'API Python"),r("OutboundLink")],1),e._v(" de QGIS, j'ai été en mesure de développer un plugin simple qui "),r("strong",[e._v("répond entièrement")]),e._v(" au besoin défini par les utilisateurs.")]),e._v(" "),r("p",[e._v("Cependant, bien que le résultat final tienne sur une dizaine de lignes, le début du développement s'avéra difficile.")]),e._v(" "),r("p",[e._v("En effet, j'ai eu du mal à prendre l'API en main car je n'avais encore jamais eu l'occasion de travailler sur un projet de l'envergure de QGIS.")]),e._v(" "),r("p",[e._v("J'ai donc commencé par produire du code qui se trouva être une "),r("strong",[e._v("mauvaise réecriture")]),e._v(" d'outils proposés directement par l'API.")]),e._v(" "),r("p",[e._v("En voyant que je me dirigeais vers un code assez "),r("strong",[e._v("compliqué à lire et manipuler")]),e._v(", j'ai décidé de prendre du temps pour "),r("strong",[e._v("analyser la documentation")]),e._v(" de l'API. Par chance, elle se trouve être de bonne qualité, ce qui m'a permis d'arriver au résultat présenté.")]),e._v(" "),r("p",[e._v("Ce projet m'aura appris à "),r("strong",[e._v("appréhender un projet de grande envergure")]),e._v(" et m'aura permis de gagner en rapidité quant à la "),r("strong",[e._v("recherche d'informations")]),e._v(" dans une documentation complexe.")])])}),[],!1,null,null,null);t.default=n.exports}}]);