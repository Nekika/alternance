(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{371:function(t,e,s){t.exports=s.p+"assets/img/icon.42297858.png"},372:function(t,e,s){t.exports=s.p+"assets/img/v1-preview.70f7ddba.gif"},373:function(t,e,s){t.exports=s.p+"assets/img/v2-preview.85cd155b.gif"},374:function(t,e,s){t.exports=s.p+"assets/img/qt.d3ef83eb.png"},375:function(t,e,s){t.exports=s.p+"assets/img/v2-designer.748af71c.png"},376:function(t,e,s){t.exports=s.p+"assets/img/v2-ui.ad24e163.png"},403:function(t,e,s){"use strict";s.r(e);var n=s(42),a=Object(n.a)({},(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"smc-selection-multi-couches"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#smc-selection-multi-couches"}},[t._v("#")]),t._v(" SMC (Sélection Multi Couches)")]),t._v(" "),n("p",[n("img",{attrs:{src:s(371),alt:"icon-smc"}})]),t._v(" "),n("h2",{attrs:{id:"introduction"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#introduction"}},[t._v("#")]),t._v(" Introduction")]),t._v(" "),n("p",[t._v("J'ai été chargé de créer un "),n("strong",[t._v("plugin")]),t._v(" pour QGIS, permettant de "),n("strong",[t._v("sélectionner d'un seul coup toutes les entités visibles dans l'interface, et ceux pour toutes les couches du projet")]),t._v(".")]),t._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("Informations")]),t._v(" "),n("p",[n("strong",[t._v("Contexte")]),t._v(" : Le logiciel QGIS est utilisé par les géomaticiens et les agents de terrain chargés de collecter des données à travers le département de Meurthe-et-Moselle.")]),t._v(" "),n("p",[n("strong",[t._v("Problème")]),t._v(" : N'ayant pas de connexion internet sur le terrain, les agents n'ont donc pas accès aux bases de données. Il sont alors contraints de sauvegader les données sur leur ordinateur portable avant de partir. Cette tâche est fastidieuse puisqu'ils doivent sélectionner manuellement chaque entité qu'ils souhaient sauvegarder en cliquant dessus. Cela devient très pénible pour des projets de grande envergure.")]),t._v(" "),n("p",[n("strong",[t._v("Objectif")]),t._v(" : Développer un plugin QGIS permettant la sélection de toutes les entités présentes dans l'emprise définie par l'utilisateur.")]),t._v(" "),n("p",[n("strong",[t._v("Technologie utilisée")]),t._v(" : Python")])]),t._v(" "),n("h2",{attrs:{id:"analyse"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#analyse"}},[t._v("#")]),t._v(" Analyse")]),t._v(" "),n("p",[t._v("Ma mission consistant à "),n("strong",[t._v("développer un plugin")]),t._v(", j'ai donc commencé par prendre le temps de "),n("strong",[t._v("chercher des informations")]),t._v(" et de lire la "),n("a",{attrs:{href:"https://docs.qgis.org/3.10/fr/docs/index.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("documentation"),n("OutboundLink")],1),t._v(" avant "),n("strong",[t._v("d'analyser le besoin")]),t._v(".")]),t._v(" "),n("h3",{attrs:{id:"integration-d-un-plugin"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#integration-d-un-plugin"}},[t._v("#")]),t._v(" Intégration d'un plugin")]),t._v(" "),n("p",[t._v("Afin d'intégrer un "),n("strong",[t._v("plugin local")]),t._v(", QGIS nous propose de placer notre code dans un répertoire qu'il viendra "),n("strong",[t._v("scanner au démarrage")]),t._v(" :")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Exemple de structure de fichiers")]),t._v("\n\n-- "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$REPERTOIRE_QGIS")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("-- profiles/\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("-- default/\n      "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("-- python/\n        "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("-- plugins/\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("-- mon_profil/\n      "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("-- python/\n        "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("-- plugins/\n")])])]),n("ul",[n("li",[n("p",[n("code",[t._v("profiles/")]),t._v(" : le répertoire qui stocke les différents profils utilisateurs.")])]),t._v(" "),n("li",[n("p",[n("code",[t._v("profiles/*/python/plugins")]),t._v(" : le sous-répertoire scanné par QGIS, dans lequel on peut retrouver le code source des extensions.")])])]),t._v(" "),n("div",{staticClass:"custom-block warning"},[n("p",{staticClass:"custom-block-title"},[t._v("Note")]),t._v(" "),n("p",[t._v("Le répertoire "),n("code",[t._v("profiles/default")]),t._v(" permet de définir des configurations qui seront appliqués à l'utilisateur par défaut "),n("strong",[t._v("ET")]),t._v(" à tous les utilisateurs.")]),t._v(" "),n("p",[t._v("Ainsi, dans le répertoire "),n("code",[t._v("profiles/default/python/plugins")]),t._v(" on pourra retrouver des extensions disponibles pour tous les utilisateurs tandis que le répertoire "),n("code",[t._v("profiles/mon_profil/python/plugins")]),t._v(" contiendra des extentions destinées à l'utilisateur "),n("em",[t._v("mon_profil")]),t._v(" "),n("strong",[t._v("uniquement")]),t._v(".")])]),t._v(" "),n("h3",{attrs:{id:"developpement-d-un-plugin"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#developpement-d-un-plugin"}},[t._v("#")]),t._v(" Développement d'un plugin")]),t._v(" "),n("p",[t._v("Pour le développement de plugins, QGIS encourage l'utilisation de "),n("strong",[t._v("Python")]),t._v(" plutôt que C++.")]),t._v(" "),n("p",[t._v("Ainsi, sur la documentation officielle de QGIS, on peut retrouver le "),n("a",{attrs:{href:"https://docs.qgis.org/3.10/en/docs/pyqgis_developer_cookbook/index.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("PyQGIS Developer Cookbook"),n("OutboundLink")],1),t._v(" qui explique de manière détaillée la marche à suivre pour créer un plugin en utilisant "),n("a",{attrs:{href:"https://qgis.org/pyqgis/3.0/",target:"_blank",rel:"noopener noreferrer"}},[t._v("l'API Python"),n("OutboundLink")],1),t._v(".")]),t._v(" "),n("h4",{attrs:{id:"structure-d-un-plugin"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#structure-d-un-plugin"}},[t._v("#")]),t._v(" Structure d'un plugin")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Structure minimale")]),t._v("\n\n-- "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$REPERTOIRE_QGIS_PLUGINS")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("-- mon_super_plugin/\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("-- __init__.py\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("-- form.ui\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("-- form.py\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("-- metadata.txt\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("-- mon_super_plugin.py\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("-- resources.py\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("-- resources.qrc\n")])])]),n("ul",[n("li",[n("p",[n("code",[t._v("__init__.py")]),t._v(" : le point d'entrée du plugin.")])]),t._v(" "),n("li",[n("p",[n("code",[t._v("form.ui")]),t._v(" : l'interface utilisateur que l'on peut éditer avec "),n("a",{attrs:{href:"https://doc.qt.io/qt-5/qtdesigner-manual.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Qt Designer"),n("OutboundLink")],1),t._v(".")])]),t._v(" "),n("li",[n("p",[n("code",[t._v("form.py")]),t._v(" : une classe réprésentant l'interface utilisateur du plugin, basée sur le contenu du fichier "),n("code",[t._v("form.ui")]),t._v(".")])]),t._v(" "),n("li",[n("p",[n("code",[t._v("metadata.txt")]),t._v(" : les métadonnées relatives au plugin.")])]),t._v(" "),n("li",[n("p",[n("code",[t._v("mon_super_plugin.py")]),t._v(" : le code source du plugin.")])]),t._v(" "),n("li",[n("p",[n("code",[t._v("resources.py")]),t._v(" : la version compilée en Python de "),n("code",[t._v("resources.qrc")])])]),t._v(" "),n("li",[n("p",[n("code",[t._v("resources.qrc")]),t._v(" : un fichier au format XML créé par "),n("a",{attrs:{href:"https://doc.qt.io/qt-5/qtdesigner-manual.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Qt Designer"),n("OutboundLink")],1),t._v(" et contenant des informations relatives à l'interface utilisateur.")])])]),t._v(" "),n("p",[t._v("Ces fichiers composent le "),n("strong",[t._v("squelette de base")]),t._v(" d'un plugin QGIS.")]),t._v(" "),n("p",[t._v("Pour un plugin d'une "),n("strong",[t._v("plus grande ampleur")]),t._v(" il est possible de se retrouver avec des architectures telles que celle-ci :")]),t._v(" "),n("p",[t._v("Dans notre cas, une "),n("strong",[t._v("structure simple")]),t._v(" telle que celle ci-dessus suffira puisque le plugin ne contiendra que "),n("strong",[t._v("quelques instructions")]),t._v(".")]),t._v(" "),n("h3",{attrs:{id:"besoin"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#besoin"}},[t._v("#")]),t._v(" Besoin")]),t._v(" "),n("p",[t._v("Il faut permettre à l'utilisateur de "),n("strong",[t._v("gagner du temps")]),t._v(" en obtenant "),n("strong",[t._v("immédiatement")]),t._v(" une sélection de "),n("strong",[t._v("toutes les entités")]),t._v(" présentes dans l'emprise, tout en effectuant "),n("strong",[t._v("le moins d'action possible")]),t._v(".")]),t._v(" "),n("h2",{attrs:{id:"solution-proposee"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#solution-proposee"}},[t._v("#")]),t._v(" Solution proposée")]),t._v(" "),n("p",[t._v("Il s'avère qu'au cours de mes quelques mois au sein du service SIG, j'ai eu l'occasion de travaillé deux fois sur ce projet.")]),t._v(" "),n("p",[t._v("En effet, au mois d'octobre j'ai développé et livré une première version de l'outil afin de répondre au besoin primaire des utilisateurs.")]),t._v(" "),n("p",[t._v("Bien que cette solution ait fait l'affaire pendant quelques mois, avant et après la période de confinement causée par la crise sanitaire du COVID-19, les utilisateurs m'ont remonté des idées d'amélioration au mois de juillet.")]),t._v(" "),n("p",[t._v("Je me suis donc chargé de développer une nouvelle version du plugin afin de répondre aux nouveaux besoins des utilisateurs.")]),t._v(" "),n("h3",{attrs:{id:"premiere-version"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#premiere-version"}},[t._v("#")]),t._v(" Première version")]),t._v(" "),n("p",[t._v("L'idée est de fournir un outil capable d'effectuer la sélection "),n("strong",[t._v("en un seul clic")]),t._v(" :")]),t._v(" "),n("p",[n("img",{attrs:{src:s(372),alt:"SMC v1 preview"}})]),t._v(" "),n("div",{staticClass:"custom-block warning"},[n("p",{staticClass:"custom-block-title"},[t._v("Note")]),t._v(" "),n("p",[t._v("Les utilisateurs finaux sélectionnent les entités de toutes les couches du projet, sauf une (la couche "),n("em",[t._v("Communes")]),t._v(").")]),t._v(" "),n("p",[t._v("Il n'était alors pas nécessaire de fournir une interface utilisateur permettant de sélectionner les couches sur lesquelles effectuer la sélection.")])]),t._v(" "),n("h4",{attrs:{id:"structure"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#structure"}},[t._v("#")]),t._v(" Structure")]),t._v(" "),n("p",[t._v("L'architecture est très "),n("strong",[t._v("simplifiée")]),t._v(" puisque d'une part il n'y a que quelques instructions à fournir, et d'autre part il n'y a pas besoin d'interface utilisateur :")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("-- "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$REPERTOIRE_QGIS_PLUGINS")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("-- SMC/\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("-- __init.py__\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("-- icon.png\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("-- metadata.txt\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("-- pb_tool.cfg\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("-- smc.py\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("-- README.md\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("-- resources.py\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("-- resources.qrc\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("-- tools.py\n")])])]),n("p",[t._v("On remarque tout de même la présence de nouveaux fichiers :")]),t._v(" "),n("ul",[n("li",[n("p",[n("code",[t._v("icon.png")]),t._v(" : l'icone qui représente le plugin dans l'interface de QGIS.")])]),t._v(" "),n("li",[n("p",[n("code",[t._v("pb_tool.cfg")]),t._v(" : un outil permettant de compiler le plugin, voir "),n("a",{attrs:{href:"http://g-sherman.github.io/plugin_build_tool/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Plugin Builder Tool"),n("OutboundLink")],1),t._v(".")])]),t._v(" "),n("li",[n("p",[n("code",[t._v("tools.py")]),t._v(" : des fonctions dont la présence au sein du coeur du plugin n'était pas pertinente.")])])]),t._v(" "),n("h4",{attrs:{id:"code"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#code"}},[t._v("#")]),t._v(" Code")]),t._v(" "),n("p",[t._v("L'utilisation de "),n("a",{attrs:{href:"https://qgis.org/pyqgis/3.0/",target:"_blank",rel:"noopener noreferrer"}},[t._v("l'API Python"),n("OutboundLink")],1),t._v(" de QGIS rend le code "),n("strong",[t._v("simple à lire et à comprendre")]),t._v(" même pour quelqu'un n'ayant jamais manipuler Python. Je vais donc me permettre de détailler le fonctionnement du plugin.")]),t._v(" "),n("p",[t._v("Le "),n("strong",[t._v("fichier principal")]),t._v(" ( "),n("code",[t._v("smc.py")]),t._v(" ) est une classe qui doit implémenter des "),n("strong",[t._v("méthodes définies par l'API")]),t._v(".")]),t._v(" "),n("p",[t._v("Ces méthodes servent à "),n("strong",[t._v("configurer")]),t._v(" le plugin lors du démarrage de QGIS. Elles sont donc "),n("strong",[t._v("indispensables")]),t._v(".")]),t._v(" "),n("div",{staticClass:"custom-block warning"},[n("p",{staticClass:"custom-block-title"},[t._v("Note")]),t._v(" "),n("p",[t._v("L'idée n'étant pas d'expliquer les mécanismes derrière le fonctionnement global d'un plugin, je me contenterai d'expliquer ce que j'ai développé.")]),t._v(" "),n("p",[t._v("Pour plus de détail sur ces méthodes ou sur le fonctionnement des plugins, se référer au "),n("a",{attrs:{href:"https://docs.qgis.org/3.10/en/docs/pyqgis_developer_cookbook/plugins/plugins.html#writing-a-plugin",target:"_blank",rel:"noopener noreferrer"}},[t._v("PyQGIS Developer Cookbook"),n("OutboundLink")],1),t._v(".")])]),t._v(" "),n("p",[t._v("Parmi les méthodes "),n("strong",[t._v("indispensables")]),t._v(", on peut retrouver "),n("code",[t._v("run()")]),t._v(".")]),t._v(" "),n("p",[t._v("C'est elle qui sera appelée lorsque l'utilisateur souhaite se servir du plugin, c'est donc à l'intérieur que l'on va indiquer les "),n("strong",[t._v("actions à effectuer")]),t._v(" :")]),t._v(" "),n("p",[n("strong",[n("code",[t._v("smc.py")])])]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  layers "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" get_all_vectorLayers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  extent "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_extent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  select_features_in_area"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("layers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" extent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("On remarque que cette méthode fait appel à "),n("strong",[t._v("2 fonctions")]),t._v(" et "),n("strong",[t._v("une autre méthode")]),t._v(" :")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("get_all_vectorLayers()")])])]),t._v(" "),n("p",[t._v("Cette fonction permet de "),n("strong",[t._v("récupérer la liste des couches vectorielles")]),t._v(" du projet puisque c'est sur celles-ci que sont représentées les entités à sélectionner :")]),t._v(" "),n("p",[n("strong",[n("code",[t._v("tools.py")])])]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("get_all_vectorLayers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    res "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    layers "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" QgsProject"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("instance"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mapLayers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("values"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" layer "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" layers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" layer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("type")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("and")]),t._v(" layer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Communes"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("append"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("layer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" res\n")])])]),n("p",[t._v("En se référant à la classe "),n("a",{attrs:{href:"https://qgis.org/pyqgis/master/core/QgsMapLayer.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("QgsMapLayer"),n("OutboundLink")],1),t._v(", on découvre que la méthode "),n("code",[t._v("type()")]),t._v(" nous offre le moyen de "),n("strong",[t._v("connaître le type de la couche")]),t._v(" :")]),t._v(" "),n("ul",[n("li",[n("p",[n("strong",[t._v("VectorLayer")]),t._v(" : 0")])]),t._v(" "),n("li",[n("p",[n("strong",[t._v("RasterLayer")]),t._v(" : 1")])]),t._v(" "),n("li",[n("p",[n("strong",[t._v("PluginLayer")]),t._v(" : 2")])]),t._v(" "),n("li",[n("p",[n("strong",[t._v("MeshLayer")]),t._v(" : 3")])]),t._v(" "),n("li",[n("p",[n("strong",[t._v("VectorTileLayer")]),t._v(" : 4")])])]),t._v(" "),n("p",[t._v("La condition "),n("code",[t._v('if layer.type() == 0 and layer.name() != "Communes":')]),t._v(" permet donc de s'assurer d'une part que la couche traitée est bel et bien de "),n("strong",[t._v("type vectoriel")]),t._v(", et d'autre par que la couche traitée n'est pas la couche "),n("em",[t._v("Communes")]),t._v(".")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("get_extent()")])])]),t._v(" "),n("p",[t._v("C'est la méthode qui va permettre de "),n("strong",[t._v("récupérer les coordonnées de l'emprise")]),t._v(" réglée par l'utilisateur :")]),t._v(" "),n("p",[n("strong",[n("code",[t._v("smc.py")])])]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("get_extent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  mapcanvas "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("iface"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mapCanvas"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  extent "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" mapcanvas"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("extent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" extent\n")])])]),n("p",[t._v("La méthode se contente de "),n("strong",[t._v("récupérer l'instance de "),n("a",{attrs:{href:"https://qgis.org/pyqgis/master/gui/QgsMapCanvas.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("MapCanvas"),n("OutboundLink")],1)]),t._v(" et d'utiliser la méthode "),n("code",[t._v("extent()")]),t._v(" pour pouvoir "),n("strong",[t._v("récupérer les coordonées")]),t._v(" de l'emprise.")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("select_features_in_area()")])])]),t._v(" "),n("p",[t._v("Les tâches effectuées en amont ayant permis de récupérer des données qui sont nécessaires pour pouvoir répondre au besoin, cette dernière fonction va se charger "),n("strong",[t._v("d'effectuer la sélection")]),t._v(" de toutes les entités présentes dans l'emprise :")]),t._v(" "),n("p",[n("strong",[n("code",[t._v("smc.py")])])]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("select_features_in_area")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("layers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" area"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" layer "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" layers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    layer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("selectByRect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("area"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("Cette fonction très simple fait appel à la méthode "),n("code",[t._v("selectByRect")]),t._v(" de la classe "),n("a",{attrs:{href:"https://qgis.org/pyqgis/master/core/QgsVectorLayer.html#qgis.core.QgsVectorLayer.selectByRect",target:"_blank",rel:"noopener noreferrer"}},[t._v("QgsVectorLayer"),n("OutboundLink")],1),t._v(" et elle permet, à partir d'une couche vectorielle, de "),n("strong",[t._v("sélectionner toutes les entités contenues au sein d'un rectangle")]),t._v(".")]),t._v(" "),n("p",[t._v("Dans notre cas, le rectangle n'est autre que "),n("strong",[t._v("l'emprise")]),t._v(" réglée par l'utilisateur.")]),t._v(" "),n("h3",{attrs:{id:"retour-utilisateur"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#retour-utilisateur"}},[t._v("#")]),t._v(" Retour utilisateur")]),t._v(" "),n("p",[t._v("Après "),n("strong",[t._v("quelques mois d'utilisation")]),t._v(", les utilisateurs m'ont fait quelques "),n("strong",[t._v("retours constructifs")]),t._v(" quant à "),n("strong",[t._v("l'utilisation réelle")]),t._v(" de l'extension.")]),t._v(" "),n("h4",{attrs:{id:"point-positif"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#point-positif"}},[t._v("#")]),t._v(" Point positif")]),t._v(" "),n("p",[t._v("L'extension "),n("strong",[t._v("répond parfaitement au besoin primaire")]),t._v(" des utilisateurs et leur permet de "),n("strong",[t._v("gagner un temps précieux")]),t._v(".")]),t._v(" "),n("h4",{attrs:{id:"points-negatifs"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#points-negatifs"}},[t._v("#")]),t._v(" Points négatifs")]),t._v(" "),n("ul",[n("li",[n("strong",[t._v("Sélection trop importante")]),t._v(" : la plupart du temps, les utilisateurs ne souhaitent sélectionner des entités qu'au sein d'une, deux voir trois communes. La sélection rectangulaire englobe donc un grand nombre d'entités inutiles.")]),t._v(" "),n("li",[n("strong",[t._v("Fonds de plans")]),t._v(" : il peut arriver que les utilisateurs aient besoin de sélectionner les fonds de plans. Or, dans la version actuelle du plugin il est impossible de le faire.")])]),t._v(" "),n("h3",{attrs:{id:"deuxieme-version"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#deuxieme-version"}},[t._v("#")]),t._v(" Deuxième version")]),t._v(" "),n("p",[t._v("Afin de répondre aux "),n("strong",[t._v("nouveaux besoins")]),t._v(" des utilisateurs, il a été nécessaire de "),n("strong",[t._v("repenser totalement")]),t._v(" l'utilisation du plugin.")]),t._v(" "),n("p",[t._v("Très vite, la nécessité de fournir une "),n("strong",[t._v("interface homme-machine")]),t._v(" est apparue, car les nouvelles fonctionnalités à implémenter nécessecitent obligatoirement des "),n("strong",[t._v("actions de la part de l'utilisateur")]),t._v(".")]),t._v(" "),n("p",[t._v("Bien que le fonctionnement de l'extension soit "),n("strong",[t._v("plus complexe")]),t._v(", l'idée derrière reste "),n("strong",[t._v("similaire")]),t._v(" à celle de la première version :")]),t._v(" "),n("ol",[n("li",[n("strong",[t._v("Emprise")]),t._v(" : L'utilisateur règle l'emprise sur les communes qui l'intéressent.")]),t._v(" "),n("li",[n("strong",[t._v("Interface utilisateur")]),t._v(" : Au lancement du plugin, une interface utilisateur listant ces communes apparaît.")]),t._v(" "),n("li",[n("strong",[t._v("Actions utilisateur")]),t._v(" : L'utilisateur peut alors sélectionner les communes sur lesquelles il souhaite effectuer la sélection. Une case à cocher permet d'indiquer à l'extension si elle doit intégrer les fonds de plans dans la sélection.")]),t._v(" "),n("li",[n("strong",[t._v("Lancement de la sélection")]),t._v(" : Un bouton "),n("em",[t._v("Valider")]),t._v(" permet de lancer la sélection.")])]),t._v(" "),n("p",[n("img",{attrs:{src:s(373),alt:"SMC v2 preview"}})]),t._v(" "),n("h4",{attrs:{id:"structure-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#structure-2"}},[t._v("#")]),t._v(" Structure")]),t._v(" "),n("hr"),t._v(" "),n("p",[t._v("Au niveau de l'organisation, cette nouvelle version a nécessité l'ajout de "),n("strong",[t._v("nouveaux éléments")]),t._v(" :")]),t._v(" "),n("div",{staticClass:"language-shell extra-class"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[t._v("-- "),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$REPERTOIRE_QGIS_PLUGINS")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("-- SMC/\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("-- utils/\n      "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("-- __init.py__\n      "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("-- ui.py\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("-- README.md\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("-- __init.py__\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("-- icon.png\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("-- metadata.txt\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("-- pb_tool.cfg\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("-- resources.py\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("-- resources.qrc\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("-- smc.py\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("-- smc_dialog.py\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("-- smc_dialog_base.ui\n")])])]),n("ul",[n("li",[n("code",[t._v("smc_dialog_base.ui")]),t._v(" : la structure de l'interface utilisateur.")]),t._v(" "),n("li",[n("code",[t._v("smc_dialog.py")]),t._v(" : la classe représentant l'interface utilisateur.")]),t._v(" "),n("li",[n("code",[t._v("utils/ui.py")]),t._v(" : un ensemble de fonctions facilitant la manipulation de l'interface utilisateur lors de l'execution du plugin.")])]),t._v(" "),n("p",[t._v("La "),n("strong",[t._v("majorité du fonctionnement")]),t._v(" de l'extension se trouve toujours au sein du fichier "),n("code",[t._v("smc.py")]),t._v(".")]),t._v(" "),n("h4",{attrs:{id:"code-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#code-2"}},[t._v("#")]),t._v(" Code")]),t._v(" "),n("hr"),t._v(" "),n("p",[t._v("Nous nous contenterons ici de présenter les "),n("strong",[t._v("différences majeures")]),t._v(" entre les deux versions, n'hésitez donc pas à revoir "),n("RouterLink",{attrs:{to:"/projets-annexes/smc.html#code"}},[t._v("les extraits de code")]),t._v(" de la première version.")],1),t._v(" "),n("p",[n("strong",[t._v("Interface utilisateur")])]),t._v(" "),n("p",[t._v("La plus grande différence est l'apparition d'une interface utilisateur au moment où le plugin est lancé. Son rôle est de permettre l'interaction entre l'utilisateur et l'extension.")]),t._v(" "),n("p",[t._v("Afin de rendre cette interaction possible, j'ai eu recours à "),n("a",{attrs:{href:"https://doc.qt.io/qtforpython/",target:"_blank",rel:"noopener noreferrer"}},[t._v("PyQt"),n("OutboundLink")],1),t._v(" (la version Python de "),n("a",{attrs:{href:"https://qt.io",target:"_blank",rel:"noopener noreferrer"}},[t._v("Qt"),n("OutboundLink")],1),t._v(" - "),n("em",[t._v("un célèbre ensemble de librairies C++")]),t._v(").")]),t._v(" "),n("p",[n("img",{attrs:{src:s(374),alt:"logo-qt"}})]),t._v(" "),n("p",[t._v("PyQt étant "),n("strong",[t._v("nativement intégré")]),t._v(" à QGIS, je n'ai pas eu à me soucier de la moindre installation.")]),t._v(" "),n("p",[t._v("J'ai commencé par "),n("strong",[t._v("concevoir l'interface")]),t._v(" à l'aide de "),n("a",{attrs:{href:"https://doc.qt.io/qt-5/qtdesigner-manual.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Qt Designer"),n("OutboundLink")],1),t._v(", un logiciel permettant de créer des interfaces utilisateurs composées "),n("strong",[t._v("d'éléments manipulables à l'aide de Qt")]),t._v(" ("),n("a",{attrs:{href:"https://doc.qt.io/qt-5/qtwidgets-index.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Qt Widgets"),n("OutboundLink")],1),t._v(").")]),t._v(" "),n("p",[n("img",{attrs:{src:s(375),alt:"SMC v2 QtDesigner"}})]),t._v(" "),n("p",[t._v("L'interface utilisateur est composée d'une "),n("strong",[t._v("table")]),t._v(" ("),n("a",{attrs:{href:"https://doc.qt.io/qtforpython/PySide2/QtWidgets/QTableWidget.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("QTableWidget"),n("OutboundLink")],1),t._v(") dans laquelle seront listées les "),n("strong",[t._v("communes visibles dans l'emprise")]),t._v(", d'une "),n("strong",[t._v("case à cocher")]),t._v(" ("),n("a",{attrs:{href:"https://doc.qt.io/qtforpython/PySide2/QtWidgets/QCheckBox.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("QCheckBox"),n("OutboundLink")],1),t._v(") permettant d'indiquer s'il faut "),n("strong",[t._v("inclure les fonds de plans")]),t._v(" ainsi que d'un "),n("strong",[t._v("boutton")]),t._v(" "),n("em",[t._v("Valider")]),t._v(" pour "),n("strong",[t._v("lancer la sélection")]),t._v(" et un "),n("strong",[t._v("boutton")]),t._v(" "),n("em",[t._v("Annuler")]),t._v(" pour "),n("strong",[t._v("fermer la fenêtre")]),t._v(" ("),n("a",{attrs:{href:"https://doc.qt.io/qtforpython/PySide2/QtWidgets/QPushButton.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("QPushButton"),n("OutboundLink")],1),t._v(").")]),t._v(" "),n("p",[t._v("Au sein du fichier "),n("code",[t._v("utils/ui.py")]),t._v(", on peut retrouver des fonctions qui aideront à créer les éléments à insérer dans la "),n("strong",[t._v("table")]),t._v(" :")]),t._v(" "),n("p",[n("strong",[n("code",[t._v("utils/ui.py")])])]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" qgis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("PyQt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("QtWidgets "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" QTableWidgetItem\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" qgis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("PyQt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("QtCore "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Qt\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("create_label")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("text"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    item "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" QTableWidgetItem"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("text"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    item"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("setFlags"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Qt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("NoItemFlags"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    item"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("setTextAlignment"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Qt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AlignCenter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" item\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("create_checkbox")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    item "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" QTableWidgetItem"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    item"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("setFlags"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Qt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ItemIsUserCheckable "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" Qt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ItemIsEnabled"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    item"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("setCheckState"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Qt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Unchecked"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" item\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("create_rows")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("communes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    rows "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" c "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" communes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        label"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" checkbox "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" create_label"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("c"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("attribute"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nom"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" create_checkbox"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        rows"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("append"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("dict")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("label"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("label"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" checkbox"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("checkbox"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" rows\n")])])]),n("ul",[n("li",[n("code",[t._v("create_label()")]),t._v(" : crée un objet ("),n("a",{attrs:{href:"https://doc.qt.io/qtforpython/PySide2/QtWidgets/QTableWidgetItem.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("QTableWidgetItem"),n("OutboundLink")],1),t._v(") qui sera utilisé pour afficher le nom d'une commune.")]),t._v(" "),n("li",[n("code",[t._v("create_checkbox()")]),t._v(" : crée un objet ("),n("a",{attrs:{href:"https://doc.qt.io/qtforpython/PySide2/QtWidgets/QTableWidgetItem.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("QTableWidgetItem"),n("OutboundLink")],1),t._v(") qui sera utilisé pour afficher une case à cocher.")]),t._v(" "),n("li",[n("code",[t._v("create_rows()")]),t._v(" : à partir d'une liste de communes, crée une liste d'objets ("),n("a",{attrs:{href:"https://doc.qt.io/qtforpython/PySide2/QtWidgets/QTableWidgetItem.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("QTableWidgetItem"),n("OutboundLink")],1),t._v(") représentant une ligne à insérer dans la table listant les communes.")])]),t._v(" "),n("p",[t._v("La fonction "),n("code",[t._v("create_rows()")]),t._v(" est appelée au sein de la méthode "),n("code",[t._v("fill_table()")]),t._v(" :")]),t._v(" "),n("p",[n("strong",[n("code",[t._v("smc.py")])])]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("fill_table")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" communes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      rows"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" table "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("sorted")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ui"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("create_rows"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("communes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("lambda")]),t._v(" k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"label"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dlg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tw_communes\n      table"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("setRowCount"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("len")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rows"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" index"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" row "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("enumerate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rows"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          table"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("setItem"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("index"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" row"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"label"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n          table"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("setItem"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("index"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" row"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"checkbox"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("Voici l'interface telle qu'elle a été proposée puis validée par les utilisateurs :")]),t._v(" "),n("p",[n("img",{attrs:{src:s(376),alt:"SMC v2 UI"}})]),t._v(" "),n("p",[t._v("Elle répond aux besoins de "),n("strong",[t._v("simplicité d'utilisation")]),t._v(" et de "),n("strong",[t._v("pertinence de la sélection")]),t._v(" puisqu'elle offre aux utilisateurs la possibiltié de "),n("strong",[t._v("tout configurer")]),t._v(" à l'aide de simples "),n("strong",[t._v("cases à cocher")]),t._v(".")]),t._v(" "),n("p",[n("strong",[t._v("Sélection")])]),t._v(" "),n("p",[t._v("Le traitement de la sélection "),n("strong",[t._v("diffère légèrement")]),t._v(" de la première version pour "),n("strong",[t._v("deux raisons majeures")]),t._v(" :")]),t._v(" "),n("ol",[n("li",[n("strong",[t._v("Traitement pré-selection")])])]),t._v(" "),n("p",[t._v("Il est nécessaire de "),n("strong",[t._v("récupérer")]),t._v(" et "),n("strong",[t._v("prendre en compte les choix de l'utilisateur")]),t._v(".")]),t._v(" "),n("p",[t._v("De ce fait, des "),n("strong",[t._v("étapes supplémentaires")]),t._v(" permettant notamment de récupérer la liste des communes sélectionnées ont du être ajoutées :")]),t._v(" "),n("p",[n("strong",[n("code",[t._v("smc.py")])])]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("selected_communes_names")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" table "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dlg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tw_communes\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" row "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("range")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("table"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rowCount"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        is_selected "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" table"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("item"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("row"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("checkState"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" Qt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Checked\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" is_selected"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("append"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("table"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("item"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("row"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("text"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" res\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("selected_communes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" communes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    selected_communes_names "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("selected_communes_names"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("c "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" c "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("list")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("communes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("getFeatures"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" c"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("attribute"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nom"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" selected_communes_names"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),n("ul",[n("li",[n("strong",[n("code",[t._v("selected_communes_names()")])]),t._v(" : se charge de récupérer les noms des communes sélectionnées par l'utilisateur depuis la table listant les communes.")]),t._v(" "),n("li",[n("strong",[n("code",[t._v("selected_communes()")])]),t._v(" : se charge de récupérer les entités correspondantes (objets "),n("code",[t._v("QgsFeature")]),t._v(", voir "),n("a",{attrs:{href:"https://qgis.org/pyqgis/master/core/QgsFeature.html?highlight=qgsfeature#module-QgsFeature",target:"_blank",rel:"noopener noreferrer"}},[t._v("l'API"),n("OutboundLink")],1),t._v(") depuis une liste de noms de communes.")])]),t._v(" "),n("p",[t._v("Ce traitement est nécessaire puisque nous allons avoir besoin de la "),n("strong",[t._v("géométrie des communes choisies")]),t._v(" afin d'effectuer la "),n("strong",[t._v("sélection des entités")]),t._v(".")]),t._v(" "),n("ol",{attrs:{start:"2"}},[n("li",[n("strong",[t._v("Méthode de sélection")])])]),t._v(" "),n("p",[t._v("La sélection est gérée par la méthode "),n("code",[t._v("select()")]),t._v(" :")]),t._v(" "),n("p",[n("strong",[n("code",[t._v("smc.py")])])]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("select")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" communes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      QApplication"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("setOverrideCursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Qt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("WaitCursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      layers "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("l "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" l "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" QgsProject"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("instance"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mapLayers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("values"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" l"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("type")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("and")]),t._v(" l"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Communes"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dlg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cb_exclude"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("checkState"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" Qt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Checked"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          root "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" QgsProject"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("instance"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("layerTreeRoot"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n          basemaps_nodes "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" root"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("findGroup"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Fonds de plan"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("findLayers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n          basemaps_layers "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("layer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" node "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" basemaps_nodes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n          layers "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("l "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" l "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" QgsProject"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("instance"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mapLayers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("values"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" l"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("type")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("and")]),t._v(" l "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" basemaps_layers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" l "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" layers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" c "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("selected_communes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("communes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              expression "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"within($geometry, geom_from_wkt('{wkt}'))\"")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("format")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("wkt"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("c"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("geometry"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("asWkt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n              l"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("selectByExpression"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("expression"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      QApplication"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("restoreOverrideCursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dlg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("close"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("Dans un premier temps, on souhaite déterminer la "),n("strong",[t._v("liste des couches")]),t._v(" à partir desquelles on va "),n("strong",[t._v("effectuer la sélection")]),t._v(".")]),t._v(" "),n("p",[t._v("On récupère donc la liste de toutes les "),n("strong",[t._v("couches vectorielles")]),t._v(" du projet (à l'exception de la couche "),n("em",[t._v("Communes")]),t._v("), à laquelle on ajoute les couches "),n("em",[t._v("Fonds de plans")]),t._v(" si l'utilisateur le désire.")]),t._v(" "),n("p",[t._v("Dans un second temps, on entame "),n("strong",[t._v("la sélection des entités")]),t._v(". On "),n("strong",[t._v("boucle sur la liste des couches")]),t._v(" que l'on vient de déterminer, et pour chacune d'entre elle on "),n("strong",[t._v("boucle sur la liste des communes")]),t._v(" sélectionnées par l'utilisateur.")]),t._v(" "),n("p",[t._v("C'est à ce moment que la méthode de sélection est "),n("strong",[t._v("totalement différente")]),t._v(" de celle employée dans la première version de l'extension. En effet, il s'agit cette fois-ci d'une "),n("strong",[t._v("sélection par expression")]),t._v(" (voir la "),n("a",{attrs:{href:"https://docs.qgis.org/3.10/fr/docs/user_manual/working_with_vector/expression.html?highlight=expression",target:"_blank",rel:"noopener noreferrer"}},[t._v("documentation"),n("OutboundLink")],1),t._v(").")]),t._v(" "),n("p",[n("em",[n("strong",[t._v("De manière silmplifiée")])]),t._v(" : pour chaque couche "),n("code",[t._v("L")]),t._v(" et pour chaque commune "),n("code",[t._v("C")]),t._v(", on crée une "),n("strong",[t._v("expression")]),t._v(" visant toutes les "),n("strong",[t._v("entités")]),t._v(" de "),n("code",[t._v("L")]),t._v(" dont la "),n("strong",[t._v("géométrie est contenue")]),t._v(" au sein de "),n("code",[t._v("C")]),t._v(". On se contente alors "),n("strong",[t._v("d'ajouter à la sélection")]),t._v(" toutes les entités visées.")]),t._v(" "),n("h2",{attrs:{id:"conclusion"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#conclusion"}},[t._v("#")]),t._v(" Conclusion")]),t._v(" "),n("p",[t._v("En travaillant à "),n("strong",[t._v("deux reprises")]),t._v(" sur ce projet lors de mon année au sein du service SIG, j'ai pu apprendre "),n("strong",[t._v("beaucoup de choses")]),t._v(".")]),t._v(" "),n("h3",{attrs:{id:"utilisation-d-api"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#utilisation-d-api"}},[t._v("#")]),t._v(" Utilisation d'API")]),t._v(" "),n("p",[t._v("Grâce à l'API de "),n("a",{attrs:{href:"https://qgis.org/pyqgis/3.0/",target:"_blank",rel:"noopener noreferrer"}},[t._v("PyQGIS"),n("OutboundLink")],1),t._v(" et l'API de "),n("a",{attrs:{href:"https://doc.qt.io/qtforpython/",target:"_blank",rel:"noopener noreferrer"}},[t._v("PyQt"),n("OutboundLink")],1),t._v(", j'ai été en mesure de développer un plugin simple qui "),n("strong",[t._v("répond entièrement")]),t._v(" aux besoins définis par les utilisateurs.")]),t._v(" "),n("p",[t._v("Cependant, le début du développement et la prise en main de "),n("a",{attrs:{href:"https://qgis.org/pyqgis/3.0/",target:"_blank",rel:"noopener noreferrer"}},[t._v("l'API Python"),n("OutboundLink")],1),t._v(" de QGIS s'avéra "),n("strong",[t._v("assez difficile")]),t._v(" puisque mon travail sur la première version de l'extension fut ma "),n("strong",[t._v("première expérience")]),t._v(" avec une "),n("strong",[t._v("API d'une telle ampleur")]),t._v(".")]),t._v(" "),n("p",[t._v("J'ai donc commencé par produire du code qui s'est trouvé être une "),n("strong",[t._v("mauvaise réecriture")]),t._v(" d'outils existants dans l'API.")]),t._v(" "),n("p",[t._v("En voyant que je me dirigeais vers un code assez "),n("strong",[t._v("compliqué à lire et manipuler")]),t._v(", j'ai décidé de prendre du temps pour "),n("strong",[t._v("analyser la documentation")]),t._v(" de l'API. Par chance, elle se trouve être de bonne qualité, ce qui m'a permis d'arriver au résultat présenté.")]),t._v(" "),n("p",[t._v("Lors du développement de la deuxième version de l'extension, j'ai alors été capable de "),n("strong",[t._v("trouver rapidement")]),t._v(" les informations que je cherchais, en parcourant la "),n("strong",[t._v("documentation")]),t._v(" des deux API citées précédemment.")]),t._v(" "),n("p",[t._v("Ce projet m'aura donc appris à "),n("strong",[t._v("naviguer dans la documentation d'une API")]),t._v(".")]),t._v(" "),n("h3",{attrs:{id:"l-importance-du-retour-utilisateur"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#l-importance-du-retour-utilisateur"}},[t._v("#")]),t._v(" L'importance du retour utilisateur")]),t._v(" "),n("p",[t._v("Le fait d'avoir pu recevoir un "),n("strong",[t._v("retour constructif")]),t._v(" de la part des utilisateurs m'a bien fait comprendre qu'il est "),n("strong",[t._v("très difficile")]),t._v(" de concevoir un produit "),n("strong",[t._v("comblant les besoins actuels et futurs")]),t._v(" de ses utilisateurs.")]),t._v(" "),n("p",[t._v("C'est pour cette raison qu'il s'avère nécessaire d'effectuer un "),n("strong",[t._v("bon travail d'analyse")]),t._v(" et de réfléchir aux "),n("strong",[t._v("potentiels besoins futurs")]),t._v(" des utilisateurs avant de commencer le travail de développement.")]),t._v(" "),n("h3",{attrs:{id:"etat-d-avancement"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#etat-d-avancement"}},[t._v("#")]),t._v(" Etat d'avancement")]),t._v(" "),n("p",[t._v("Le projet SMC est "),n("strong",[t._v("terminé")]),t._v(" au moment où je rédige ce rapport, puisque l'extension a été "),n("strong",[t._v("livrée aux utilisateurs finaux")]),t._v(".")]),t._v(" "),n("p",[t._v("Ces derniers m'ont affirmé qu'elle "),n("strong",[t._v("répondait parfaitement à leurs besoins")]),t._v(" et que le résultat c"),n("strong",[t._v("orrespondait à ce qu'ils attendaient")]),t._v(".")]),t._v(" "),n("p",[t._v("De plus, l'extension "),n("strong",[t._v("n'est pas figée")]),t._v(" et sera capable de "),n("strong",[t._v("s'adapter")]),t._v(" à une éventuelle évolution du projet.")]),t._v(" "),n("p",[t._v("En effet, elle est conçue pour fonctionner même lorsque les utilisateurs auront envie "),n("strong",[t._v("d'ajouter, supprimer ou bien modifier des couches")]),t._v(" au sein du projet.")])])}),[],!1,null,null,null);e.default=a.exports}}]);