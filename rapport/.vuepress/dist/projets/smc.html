<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Projets - SMC | Suivi d&#39;alternance</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css">
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>
    <meta name="description" content="Ce rapport présentera l'institution et le service au sein desquels l'alternance a été réalisée.">
    <link rel="preload" href="/assets/css/0.styles.55ffc91a.css" as="style"><link rel="preload" href="/assets/js/app.0235dcb5.js" as="script"><link rel="preload" href="/assets/js/2.1039ffb8.js" as="script"><link rel="preload" href="/assets/js/13.40abae0f.js" as="script"><link rel="prefetch" href="/assets/js/10.a81034b2.js"><link rel="prefetch" href="/assets/js/11.927dbb70.js"><link rel="prefetch" href="/assets/js/12.767f95bf.js"><link rel="prefetch" href="/assets/js/14.4c2ee264.js"><link rel="prefetch" href="/assets/js/15.5f02199a.js"><link rel="prefetch" href="/assets/js/16.b1c40f1a.js"><link rel="prefetch" href="/assets/js/17.7d0df2b4.js"><link rel="prefetch" href="/assets/js/18.5ee054b0.js"><link rel="prefetch" href="/assets/js/19.74cb0c02.js"><link rel="prefetch" href="/assets/js/3.af4636dd.js"><link rel="prefetch" href="/assets/js/4.79bbb85c.js"><link rel="prefetch" href="/assets/js/5.7a817b10.js"><link rel="prefetch" href="/assets/js/6.aefc178e.js"><link rel="prefetch" href="/assets/js/7.ce805b8b.js"><link rel="prefetch" href="/assets/js/8.ffb616a8.js"><link rel="prefetch" href="/assets/js/9.56d520a4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.55ffc91a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Suivi d'alternance</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Accueil
</a></div><div class="nav-item"><a href="/presentation.html" class="nav-link">
  Présentation
</a></div><div class="nav-item"><a href="/prerequis/" class="nav-link">
  Prérequis
</a></div><div class="nav-item"><a href="/projets/" class="nav-link router-link-active">
  Projets
</a></div><div class="nav-item"><a href="/liens.html" class="nav-link">
  Liens
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Accueil
</a></div><div class="nav-item"><a href="/presentation.html" class="nav-link">
  Présentation
</a></div><div class="nav-item"><a href="/prerequis/" class="nav-link">
  Prérequis
</a></div><div class="nav-item"><a href="/projets/" class="nav-link router-link-active">
  Projets
</a></div><div class="nav-item"><a href="/liens.html" class="nav-link">
  Liens
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Projets - SMC</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/projets/smc.html#introduction" class="sidebar-link">Introduction</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/projets/smc.html#analyse" class="sidebar-link">Analyse</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/projets/smc.html#integration-d-un-plugin" class="sidebar-link">Intégration d'un plugin</a></li><li class="sidebar-sub-header"><a href="/projets/smc.html#developpement-d-un-plugin" class="sidebar-link">Développement d'un plugin</a></li><li class="sidebar-sub-header"><a href="/projets/smc.html#besoin" class="sidebar-link">Besoin</a></li></ul></li><li><a href="/projets/smc.html#solution-proposee" class="sidebar-link">Solution proposée</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/projets/smc.html#structure" class="sidebar-link">Structure</a></li><li class="sidebar-sub-header"><a href="/projets/smc.html#code" class="sidebar-link">Code</a></li></ul></li><li><a href="/projets/smc.html#conclusion" class="sidebar-link">Conclusion</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="smc-selection-multi-couches"><a href="#smc-selection-multi-couches" class="header-anchor">#</a> SMC (Sélection Multi Couches)</h1> <h2 id="introduction"><a href="#introduction" class="header-anchor">#</a> Introduction</h2> <p>J'ai été chargé de créer un plugin pour <strong>QGIS</strong> permettant de sélectionner instantanément toutes les entités visibles dans l'interface.</p> <div class="custom-block tip"><p class="custom-block-title">Informations</p> <p><strong>Contexte</strong> : Le logiciel QGIS est utilisé par les géomaticiens et les agents de terrain chargés de collecter des données à travers le département de Meurthe-et-Moselle.</p> <p><strong>Problème</strong> : N'ayant pas de connexion internet sur le terrain, les agents n'ont donc pas accès aux bases de données. Il sont alors contraints de sauvegader les données sur leur ordinateur portable avant de partir. Cette tâche est fastidieuse puisqu'ils doivent sélectionner manuellement chaque entité qu'ils souhaient sauvegarder en cliquant dessus. Cela devient très pénible pour des projets de grande envergure.</p> <p><strong>Objectif</strong> : Développer un plugin QGIS permettant la sélection de toutes les entités présentes dans l'emprise définie par l'utilisateur.</p> <p><strong>Technologie utilisée</strong> : Python</p></div> <h2 id="analyse"><a href="#analyse" class="header-anchor">#</a> Analyse</h2> <p>Ma mission consistant à <strong>développer un plugin</strong>, j'ai donc commencé par prendre le temps de <strong>chercher des informations</strong> et de lire la <a href="https://docs.qgis.org/3.10/fr/docs/index.html" target="_blank" rel="noopener noreferrer">documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> avant <strong>d'analyser le besoin</strong>.</p> <h3 id="integration-d-un-plugin"><a href="#integration-d-un-plugin" class="header-anchor">#</a> Intégration d'un plugin</h3> <p>Afin d'intégrer un plugin local, QGIS nous propose de placer notre code dans un répertoire qu'il viendra scanner au démarrage :</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># Exemple de structure de fichiers</span>

-- <span class="token variable">$REPERTOIRE_QGIS</span>
  <span class="token operator">|</span>-- profiles
    <span class="token operator">|</span>-- default
      <span class="token operator">|</span>-- python
        <span class="token operator">|</span>-- plugins
    <span class="token operator">|</span>-- mon_profil
      <span class="token operator">|</span>-- python
        <span class="token operator">|</span>-- plugins
</code></pre></div><ul><li><p><code>profiles</code> : le répertoire qui stocke les différents profils utilisateurs.</p></li> <li><p><code>profiles/*/python/plugins</code> : le sous-répertoire scanné par QGIS, dans lequel on peut retrouver le code source des extensions.</p></li></ul> <div class="custom-block warning"><p class="custom-block-title">Note</p> <p>Le répertoire <code>profiles/default</code> permet de définir des configurations qui seront appliqués à l'utilisateur par défaut <strong>ET</strong> à tous les utilisateurs.</p> <p>Ainsi, dans le répertoire <code>profiles/default/python/plugins</code> on pourra retrouver des extensions disponibles pour tous les utilisateurs tandis que le répertoire <code>profiles/mon_profil/python/plugins</code> contiendra des extentions destinées à l'utilisateur <em>mon_profil</em> <strong>uniquement</strong>.</p></div> <h3 id="developpement-d-un-plugin"><a href="#developpement-d-un-plugin" class="header-anchor">#</a> Développement d'un plugin</h3> <p>Pour le développement de plugins, QGIS encourage l'utilisation de <strong>Python</strong> plutôt que C++.</p> <p>Ainsi, sur la documentation officielle de QGIS, on peut retrouver le <a href="https://docs.qgis.org/3.10/en/docs/pyqgis_developer_cookbook/index.html" target="_blank" rel="noopener noreferrer">PyQGIS Developer Cookbook<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> qui explique de manière détaillée la marche à suivre pour créer un plugin en utilisant <a href="https://qgis.org/pyqgis/3.0/" target="_blank" rel="noopener noreferrer">l'API Python<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h4 id="structure-d-un-plugin"><a href="#structure-d-un-plugin" class="header-anchor">#</a> Structure d'un plugin</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># Structure minimale</span>

-- <span class="token variable">$REPERTOIRE_QGIS_PLUGINS</span>
  <span class="token operator">|</span>-- mon_super_plugin
    <span class="token operator">|</span>-- __init__.py
    <span class="token operator">|</span>-- form.ui
    <span class="token operator">|</span>-- form.py
    <span class="token operator">|</span>-- metadata.txt
    <span class="token operator">|</span>-- mon_super_plugin.py
    <span class="token operator">|</span>-- resources.py
    <span class="token operator">|</span>-- resources.qrc
</code></pre></div><ul><li><p><code>__init__.py</code> : le point d'entrée du plugin.</p></li> <li><p><code>form.ui</code> : l'interface utilisateur que l'on peut éditer avec <a href="https://doc.qt.io/qt-5/qtdesigner-manual.html" target="_blank" rel="noopener noreferrer">Qt Designer<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p></li> <li><p><code>form.py</code> : la version compilée en Python de <code>form.ui</code>.</p></li> <li><p><code>metadata.txt</code> : les métadonnées relatives au plugin.</p></li> <li><p><code>mon_super_plugin.py</code> : le code source du plugin.</p></li> <li><p><code>resources.py</code> : la version compilée en Python de <code>resources.qrc</code></p></li> <li><p><code>resources.qrc</code> : un fichier au format XML créé par <a href="https://doc.qt.io/qt-5/qtdesigner-manual.html" target="_blank" rel="noopener noreferrer">Qt Designer<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> et contenant des informations relatives à l'interface utilisateur.</p></li></ul> <p>Ces fichiers composent le <strong>squelette de base</strong> d'un plugin QGIS.</p> <p>Pour un plugin d'une <strong>plus grande ampleur</strong> il est possible de se retrouver avec des architectures telles que celle-ci :</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># Structure complexe</span>

-- <span class="token variable">$REPERTOIRE_QGIS_PLUGINS</span>
  <span class="token operator">|</span>-- mon_super_plugin
    <span class="token operator">|</span>-- <span class="token builtin class-name">help</span>
      <span class="token operator">|</span>-- build
        <span class="token operator">|</span>-- html
    <span class="token operator">|</span>-- make.bat
    <span class="token operator">|</span>-- Makefile
    <span class="token operator">|</span>-- <span class="token builtin class-name">source</span>
      <span class="token operator">|</span>-- conf.py
      <span class="token operator">|</span>-- index.rst
      <span class="token operator">|</span>-- _static
      <span class="token operator">|</span>-- _templates
    <span class="token operator">|</span>-- i18n
      <span class="token operator">|</span>-- af.ts
    <span class="token operator">|</span>-- icon.png
    <span class="token operator">|</span>-- __init__.py
    <span class="token operator">|</span>-- Makefile
    <span class="token operator">|</span>-- metadata.txt
    <span class="token operator">|</span>-- mon_super_plugin_dialog_base.ui
    <span class="token operator">|</span>-- mon_super_plugin_dialog.py
    <span class="token operator">|</span>-- mon_super_plugin.py
    <span class="token operator">|</span>-- pb_tool.cfg
    <span class="token operator">|</span>-- plugin_upload.py
    <span class="token operator">|</span>-- pylintrc
    <span class="token operator">|</span>-- README.html
    <span class="token operator">|</span>-- README.txt
    <span class="token operator">|</span>-- resources.py
    <span class="token operator">|</span>-- resources.qrc
    <span class="token operator">|</span>-- scripts
      <span class="token operator">|</span>-- compile-strings.sh
      <span class="token operator">|</span>-- run-env-linux.sh
      <span class="token operator">|</span>-- update-strings.sh
    <span class="token operator">|</span>-- <span class="token builtin class-name">test</span>
      <span class="token operator">|</span>-- __init__.py
      <span class="token operator">|</span>-- qgis_interface.py
      <span class="token operator">|</span>-- tenbytenraster.asc
      <span class="token operator">|</span>-- tenbytenraster.asc.aux.xml
      <span class="token operator">|</span>-- tenbytenraster.keywords
      <span class="token operator">|</span>-- tenbytenraster.lic
      <span class="token operator">|</span>-- tenbytenraster.prj
      <span class="token operator">|</span>-- tenbytenraster.qml
      <span class="token operator">|</span>-- test_init.py
      <span class="token operator">|</span>-- test_mon_super_plugin_dialog.py
      <span class="token operator">|</span>-- test_qgis_environment.py
      <span class="token operator">|</span>-- test_resources.py
      <span class="token operator">|</span>-- test_translations.py
      <span class="token operator">|</span>-- utilities.py
</code></pre></div><p>Dans notre cas, une <strong>structure simple</strong> suffira puisque le plugin ne contiendra que <strong>quelques instructions</strong>.</p> <h3 id="besoin"><a href="#besoin" class="header-anchor">#</a> Besoin</h3> <p>Il faut permettre à l'utilisateur de <strong>gagner du temps</strong> en obtenant <strong>immédiatement</strong> une sélection de <strong>toutes les entités</strong> présentes dans l'emprise, tout en effectuant <strong>le moins d'action possible</strong>.</p> <div class="custom-block warning"><p class="custom-block-title">Note</p> <p>Les utilisateurs finaux sélectionnent les entités de toutes les couches du projet, sauf une (la couche <em>Communes</em>).</p> <p>Il n'était alors pas nécessaire de fournir une interface utilisateur permettant de sélectionner les couches sur lesquelles effectuer la sélection.</p></div> <h2 id="solution-proposee"><a href="#solution-proposee" class="header-anchor">#</a> Solution proposée</h2> <p>L'idée est de fournir un outil capable d'effectuer la sélection <strong>en un seul clic</strong> :</p> <img title="" src="/assets/img/preview.70f7ddba.gif" alt="smc_preview" data-align="center"> <h3 id="structure"><a href="#structure" class="header-anchor">#</a> Structure</h3> <p>L'architecture est très <strong>simplifiée</strong> puisque d'une part il n'y a que quelques instructions à fournir, et d'autre part il n'y a pas besoin d'interface utilisateur :</p> <div class="language-shell extra-class"><pre class="language-shell"><code>-- <span class="token variable">$REPERTOIRE_QGIS_PLUGINS</span>
  <span class="token operator">|</span>-- SMC
    <span class="token operator">|</span>-- __init.py__
    <span class="token operator">|</span>-- icon.png
    <span class="token operator">|</span>-- metadata.txt
    <span class="token operator">|</span>-- pb_tool.cfg
    <span class="token operator">|</span>-- smc.py
    <span class="token operator">|</span>-- README.md
    <span class="token operator">|</span>-- resources.py
    <span class="token operator">|</span>-- resources.qrc
    <span class="token operator">|</span>-- tools.py
</code></pre></div><p>On remarque tout de même la présence de nouveaux fichiers :</p> <ul><li><p><code>icon.png</code> : l'icone qui représente le plugin dans l'interface de QGIS.</p></li> <li><p><code>pb_tool.cfg</code> : un outil permettant de compiler le plugin, voir <a href="http://g-sherman.github.io/plugin_build_tool/" target="_blank" rel="noopener noreferrer">Plugin Builder Tool<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p></li> <li><p><code>tools.py</code> : des fonctions dont la présence au sein du coeur du plugin n'était pas pertinente.</p></li></ul> <h3 id="code"><a href="#code" class="header-anchor">#</a> Code</h3> <p>L'utilisation de <a href="https://qgis.org/pyqgis/3.0/" target="_blank" rel="noopener noreferrer">l'API Python<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> de QGIS rend le code <strong>simple à lire et à comprendre</strong> même pour quelqu'un n'ayant jamais manipuler Python. Je vais donc me permettre de détailler le fonctionnement du plugin.</p> <p>Le <strong>fichier principal</strong> ( <code>smc.py</code> ) est une classe qui doit implémenter des <strong>méthodes définies par l'API</strong>.</p> <p>Ces méthodes servent à <strong>configurer</strong> le plugin lors du démarrage de QGIS. Elles sont donc <strong>indispensables</strong>.</p> <div class="custom-block warning"><p class="custom-block-title">Note</p> <p>L'idée n'étant pas d'expliquer les mécanismes derrière le fonctionnement global d'un plugin, je me contenterai d'expliquer ce que j'ai développé.</p> <p>Pour plus de détail sur ces méthodes ou sur le fonctionnement des plugins, se référer au <a href="https://docs.qgis.org/3.10/en/docs/pyqgis_developer_cookbook/plugins/plugins.html#writing-a-plugin" target="_blank" rel="noopener noreferrer">PyQGIS Developer Cookbook<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p></div> <p>Parmi les méthodes <strong>indispensables</strong>, on peut retrouver <code>run()</code>.</p> <p>C'est elle qui sera appelée lorsque l'utilisateur souhaite se servir du plugin, c'est donc à l'intérieur que l'on va indiquer les <strong>actions à effectuer</strong> :</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
  layers <span class="token operator">=</span> get_all_vectorLayers<span class="token punctuation">(</span><span class="token punctuation">)</span>
  extent <span class="token operator">=</span> self<span class="token punctuation">.</span>get_extent<span class="token punctuation">(</span><span class="token punctuation">)</span>
  select_features_in_area<span class="token punctuation">(</span>layers<span class="token punctuation">,</span> extent<span class="token punctuation">)</span>
</code></pre></div><p>On remarque que cette méthode fait appel à <strong>2 fonctions</strong> et <strong>une autre méthode</strong> :</p> <ul><li><strong><code>get_all_vectorLayers()</code></strong></li></ul> <p>Cette fonction permet de <strong>récupérer la liste des couches vectorielles</strong> du projet puisque c'est sur celles-ci que sont représentées les entités à sélectionner :</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">get_all_vectorLayers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    layers <span class="token operator">=</span> QgsProject<span class="token punctuation">.</span>instance<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mapLayers<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> layer <span class="token keyword">in</span> layers<span class="token punctuation">:</span>
        <span class="token keyword">if</span> layer<span class="token punctuation">.</span><span class="token builtin">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">and</span> layer<span class="token punctuation">.</span>name<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">&quot;Communes&quot;</span><span class="token punctuation">:</span>
            res<span class="token punctuation">.</span>append<span class="token punctuation">(</span>layer<span class="token punctuation">)</span>
    <span class="token keyword">return</span> res
</code></pre></div><p>En se référant à la classe <a href="https://qgis.org/pyqgis/master/core/QgsMapLayer.html" target="_blank" rel="noopener noreferrer">QgsMapLayer<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, on découvre que la méthode <code>type()</code> nous offre le moyen de <strong>connaître le type de la couche</strong> :</p> <ul><li><p><strong>VectorLayer</strong> : 0</p></li> <li><p><strong>RasterLayer</strong> : 1</p></li> <li><p><strong>PluginLayer</strong> : 2</p></li> <li><p><strong>MeshLayer</strong> : 3</p></li> <li><p><strong>VectorTileLayer</strong> : 4</p></li></ul> <p>La condition <code>if layer.type() == 0 and layer.name() != &quot;Communes&quot;:</code> permet donc de s'assurer d'une part que la couche traitée est bel et bien de <strong>type vectoriel</strong>, et d'autre par que la couche traitée n'est pas la couche <em>Communes</em>.</p> <ul><li><strong><code>get_extent()</code></strong></li></ul> <p>C'est la méthode qui va permettre de <strong>récupérer les coordonnées de l'emprise</strong> réglée par l'utilisateur :</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">get_extent</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
  mapcanvas <span class="token operator">=</span> self<span class="token punctuation">.</span>iface<span class="token punctuation">.</span>mapCanvas<span class="token punctuation">(</span><span class="token punctuation">)</span>
  extent <span class="token operator">=</span> mapcanvas<span class="token punctuation">.</span>extent<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> extent
</code></pre></div><p>La méthode se contente de <strong>récupérer l'instance de <a href="https://qgis.org/pyqgis/master/gui/QgsMapCanvas.html" target="_blank" rel="noopener noreferrer">MapCanvas<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></strong> et d'utiliser la méthode <code>extent()</code> pour pouvoir <strong>récupérer les coordonées</strong> de l'emprise.</p> <ul><li><strong><code>select_features_in_area()</code></strong></li></ul> <p>Les tâches effectuées en amont ayant permis de récupérer des données qui sont nécessaires pour pouvoir répondre au besoin, cette dernière fonction va se charger <strong>d'effectuer la sélection</strong> de toutes les entités présentes dans l'emprise :</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">select_features_in_area</span><span class="token punctuation">(</span>layers<span class="token punctuation">,</span> area<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">for</span> layer <span class="token keyword">in</span> layers<span class="token punctuation">:</span>
    layer<span class="token punctuation">.</span>selectByRect<span class="token punctuation">(</span>area<span class="token punctuation">)</span>
</code></pre></div><p>Cette fonction très simple fait appel à la méthode <code>selectByRect</code> de la classe <a href="https://qgis.org/pyqgis/master/core/QgsVectorLayer.html#qgis.core.QgsVectorLayer.selectByRect" target="_blank" rel="noopener noreferrer">QgsVectorLayer<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> et elle permet, à partir d'une couche vectorielle, de <strong>sélectionner toutes les entités contenues au sein d'un rectangle</strong>.</p> <p>Dans notre cas, le rectangle n'est autre que <strong>l'emprise</strong> réglée par l'utilisateur.</p> <h2 id="conclusion"><a href="#conclusion" class="header-anchor">#</a> Conclusion</h2> <p>Grâce à <a href="https://qgis.org/pyqgis/3.0/" target="_blank" rel="noopener noreferrer">l'API Python<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> de QGIS, j'ai été en mesure de développer un plugin simple qui <strong>répond entièrement</strong> au besoin défini par les utilisateurs.</p> <p>Cependant, bien que le résultat final tienne sur une dizaine de lignes, le début du développement s'avéra difficile.</p> <p>En effet, j'ai eu du mal à prendre l'API en main car je n'avais encore jamais eu l'occasion de travailler sur un projet de l'envergure de QGIS.</p> <p>J'ai donc commencé par produire du code qui se trouva être une <strong>mauvaise réecriture</strong> d'outils proposés directement par l'API.</p> <p>En voyant que je me dirigeais vers un code assez <strong>compliqué à lire et manipuler</strong>, j'ai décidé de prendre du temps pour <strong>analyser la documentation</strong> de l'API. Par chance, elle se trouve être de bonne qualité, ce qui m'a permis d'arriver au résultat présenté.</p> <p>Ce projet m'aura appris à <strong>appréhender un projet de grande envergure</strong> et m'aura permis de gagner en rapidité quant à la <strong>recherche d'informations</strong> dans une documentation complexe.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/projets/modal.html" class="prev">
        Projets - Modal
      </a></span> <span class="next"><a href="/projets/bourgs-centres.html">
        Projets - Bourgs-Centres
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.0235dcb5.js" defer></script><script src="/assets/js/2.1039ffb8.js" defer></script><script src="/assets/js/13.40abae0f.js" defer></script>
  </body>
</html>
